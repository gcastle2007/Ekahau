# WLAN Pi Profiler

# Что такое Profiler?  Перевод с оригинального гита.

Оригинальный git https://github.com/WLAN-Pi/wlanpi-profiler. Настоятельно рекомендуется к изучению!!!

## wlanpi-profiler

Profiler — это инструмент анализа возможностей клиентских Wi-Fi устройств, разработанный для WLAN Pi.

Основное назначение — автоматизировать сбор и анализ кадров запросов на ассоциацию (association frame).

Выполняет две основные функции:
- создаёт фейковую точку доступа;
- «профилирует» любые попытки клиентских запросов на ассоциацию (в которых содержат заявленные возможности клиента).

## Для чего это нужно?

Очень часто попадаются клиентские устройства, возможности которых нам не известны. Profiler помогает нам понять  различные возможностей клиентского устройства, обнаруженные в конкретной среде, помогает при проектировании, устранении неполадок и проверке беспроводной локальной сети.

Проектировщик Wi-Fi сети может захотеть учесть возможности клиентских устройств при проектировании. Сколько пространственных потоков? Какова мощность передатчика клиента? Какие диапазоны частот он поддерживает?

Специалист по устранению неполадок WLAN может лучше понять проблемы, которые он обнаруживает, зная возможности клиентского устройства. Поддерживает ли клиент .11k/r/v? Какие физические уровни поддерживает клиент? Какие каналы поддерживает клиент?

Profiler поможет вам быстрее ответить на эти вопросы.

## Возможности клиентов различаются

Возможности каждого типа клиента различаются в зависимости от таких факторов, как чипсет клиента, количество антенн, режим питания (например, режим низкого энергопотребления iOS), возраст клиента, драйвер, запрашивающее устройство и т. д.

Каждый клиент включает информацию о своих возможностях в кадр ассоциации 802.11 (association frame), отправляемый клиентским устройством точке доступа при подключении к Wi-Fi сети. Перехватив этот кадр, можно декодировать и сообщить о заявленных возможностях клиентского устройства.

> [!IMPORTANT] Однако обратите внимание, что возможности клиентского устройства будут соответствовать заявленным точкой доступа. Например, клиент с тремя пространственными потоками сообщит точке доступа с двумя пространственными потоками, что он поддерживает только два пространственных потока.

Profiler пытается решить эту проблему, объявляя наборы функций самого высокого уровня.

## Начало работы с профилировщиком на Wi-Fi Raspberry Pi

Первым шагом является запуск Profiler, который будет транслировать фейковую точку доступа. Клиентское устройство отправит кадр ассоциации при попытке подключения к фейковой точке доступа. Затем возможности клиента определяются на основе анализа фрейма ассоциации profiler'ом.

При запуске непосредственно из терминала, после профилирования текстовый отчёт выводится на экран в режиме реального времени, а результаты записываются в локальный каталог на хосте WLAN Pi. При запуске из FPMS (экранное меню WLAN Pi) на несколько секунд должен появиться баннер.

После профилирования клиента profiler сохраняет результаты, состоящие из текстового отчёта и фрейма ассоциации, в формате PCAP. Profiler также добавляет результат в ежедневно обновляемый отчёт в формате .csv файла.

1. Запуск профилировщика:

    - Убедитесь, что к WLAN Pi подключена поддерживаемая сетевая карта WLAN.

        1.1. Запуск службы профилировщика с помощью системы меню передней панели (FPMS):
        - Перейдите в Menu > > Apps > Profiler > Start

        1.2. Запуск службы вручную:

        - `sudo service wlanpi-profiler start|stop|status`

        - Хотите увидеть больше информации о прокрутке журнала, полученной из вывода service wlanpi-profiler status?

            `journalctl -u wlanpi-profiler.service`

        1.3. Запуск из терминала:

        - `sudo profiler`

    -   Как просмотреть использование CLI и страницу руководства из оболочки:

        ```
        profiler -h
        man wlanpi-profiler
        ```

2. Профилирование клиента:

   - После запуска profiler будет осуществляться широковещательная передача настроенного SSID (по умолчанию: "Profiler XXX").

   - Подключите клиентское устройство и введите любые 8 случайных символов для PSK.

   - Обратите внимание, что клиентское устройство, как и ожидалось, не пройдет аутентификацию, но запрос на ассоциацию должен быть получен.

3. Просмотр результатов:
  
   - Вы можете посмотреть результаты в веб-интерфейсе (http://<IPv4_of_WLANPi>/profiler) или в файловой системе по адресу /var/www/html/profiler.

## Установка

Profiler входит в образ WLAN Pi как пакет Debian, но если вы хотите установить его вручную, вам понадобится следующее:

Общие требования:

Адаптер (и драйвер), поддерживающий как режим монитора, так и инъекцию пакетов.
- mt76x2u, mt7921u (a8000), mt7921e (rz608/mt7921k, rz616/mt7922m) и iwlwifi (ax200, ax210, be200) регулярно тестируются (все остальные являются экспериментальными и официально не поддерживаются).

- Из рекомендуемого списка удалены адаптеры rtl88XXau (например, некоторые адаптеры Comfast), но они должны работать. Тем не менее, не создавайте здесь отчёт об ошибке для карты rtl88XXau.
Повышенные права доступа

Требования к пакету:

- Python версии 3.9 или выше
- На хосте установлены инструменты iw, iproute2, pciutils, usbutils, kmod, wpa_cli и wpasupplicant. Большинство дистрибутивов уже поставляются с ними.

# Не работает Profiler на версии 3.4.2?

На версии wlanpi 3.4.2 Profiler не работает. Нужно откатиться на 1.0.18-2.
Как это сделать?

Смотрим, на какую версию мы можем откатиться?

`apt-cache madison wlanpi-profiler`:

```
wlanpi-profiler |   1.0.20-1 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |   1.0.19-1 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |   1.0.18-2 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |     1.0.18 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |     1.0.17 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |     1.0.16 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |     1.0.15 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |     1.0.14 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
wlanpi-profiler |     1.0.13 | https://packagecloud.io/wlanpi/main/debian bullseye/main arm64 Packages
```

У меня заработала 1.0.18-2, устанавливаем её и радуемся жизни.

`apt install wlanpi-rofiler=1.0.18-2` 

# Не получается собирать пакеты с карточкой Intel BE200?

Intel BE200 накладывает определённые ограничения на запуск точки доступа на WLAN Pi в 5 Ghz.

Как их обойти? Можно из CLI запустить profiler в режиме прослушивания трафика на определённом канале. Например, мы можем послушать трафик на 35 канале. Делается это с опцией `--noAP`:
```
sudo profiler -c 36 --noAP
```

Дальше в консоль вы будете получать вывод результатов профилирования клиентов, которые будут подключаться к какому-то SSID на 36 канале:

```
2025-12-10 08:07:30,057 [INFO] profiler.py: discovered association request for f0:e4:a2:43:07:b4 to ghost
2025-12-10 08:07:30,058 [INFO] profiler.py: generating text report for f0:e4:a2:43:07:b4
---------------------------------------------
 - SSID: ghost
 - Client MAC: f0:e4:a2:43:07:b4
 - OUI manufacturer lookup: HuaweiTechno
 - Chipset lookup: Unknown
 - Frequency band: 5 GHz
 - Capture channel: 36
---------------------------------------------
802.11k                Supported
802.11r                Supported
802.11v                Supported
802.11w                Supported
802.11n                Supported (2ss)
802.11ac               Supported (2ss), MCS 0-9, [X] 160 MHz, [X] SU BF, [ ] MU BF, Beamformee STS=6
802.11ax               Not supported
802.11be               Not supported
Max Power              23 dBm
Supported Channels     36-64, 132-140, 149-165**
Number of Channels     16

Key: [X]: Supported, [ ]: Not supported
* Reported client capabilities are dependent on available features at the time of client association.
** Reported channels do not factor local regulatory domain. Detected channel sets are assumed contiguous.
```